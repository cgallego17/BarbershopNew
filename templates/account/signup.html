{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Registro" %}{% endblock %}

{% block content %}
{% if form.errors %}
<section class="page-header" style="min-height: 120px;"></section>
<script>
(function() {
  function showSignupModalWithErrors() {
    var errEl = document.getElementById("signupModalErrors");
    var formEl = document.querySelector("#signupModal form");
    if (!errEl || !formEl) return;
    var parts = [];
    {% for error in form.non_field_errors %}parts.push("{{ error|escapejs }}");{% endfor %}
    {% for field in form %}{% for error in field.errors %}parts.push("{{ error|escapejs }}");{% endfor %}{% endfor %}
    errEl.textContent = parts.length ? parts.join(" ") : "{% trans 'Revisa los datos e intenta de nuevo.' %}";
    errEl.style.display = "block";
    var emailInput = document.getElementById("modal_signup_email");
    if (emailInput) emailInput.value = "{{ form.email.value|default:''|escapejs }}";
    var fn = document.getElementById("modal_signup_first_name"); if (fn) fn.value = "{{ form.first_name.value|default:''|escapejs }}";
    var ln = document.getElementById("modal_signup_last_name"); if (ln) ln.value = "{{ form.last_name.value|default:''|escapejs }}";
    var doc = document.getElementById("modal_signup_document"); if (doc) doc.value = "{{ form.document_number.value|default:''|escapejs }}";
    var docType = document.getElementById("modal_signup_document_type"); if (docType) docType.value = "{{ form.document_type.value|default:''|escapejs }}";
    var ph = document.getElementById("modal_signup_phone"); if (ph) ph.value = "{{ form.phone.value|default:''|escapejs }}";
    var birth = document.getElementById("modal_signup_birth"); if (birth) birth.value = "{{ form.date_of_birth.value|default:''|escapejs }}";
    var ctPerson = document.getElementById("signup_type_person"); var ctCompany = document.getElementById("signup_type_company");
    if (ctPerson && ctCompany) { var ct = "{{ form.customer_type.value|default:'person'|escapejs }}"; ctPerson.checked = (ct === "person"); ctCompany.checked = (ct === "company"); }
    var modal = document.getElementById("signupModal");
    if (modal && window.bootstrap) {
      var m = bootstrap.Modal.getOrCreateInstance(modal);
      m.show();
    }
    if (window.history && window.history.replaceState) {
      history.replaceState(null, "", "{% url 'core:home' %}");
    }
  }
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", showSignupModalWithErrors);
  } else {
    showSignupModalWithErrors();
  }
})();
</script>
{% else %}
<section class="page-header">
  <div class="page-header__bg" style="background-image: url({% static 'assets/images/backgrounds/page-header-bg.jpg' %});"></div>
  <div class="container">
    <h2 class="page-header__title">{% trans "Registro" %}</h2>
    <ul class="boskery-breadcrumb list-unstyled">
      <li><a href="{% url 'core:home' %}">{% trans "Inicio" %}</a></li>
      <li><span>{% trans "Registro" %}</span></li>
    </ul>
  </div>
</section>
<section class="section-space">
  <div class="container text-center">
    <p class="mb-3">{% trans "Crea tu cuenta para guardar pedidos y comprar más rápido." %}</p>
    <a href="#" class="boskery-btn" data-bs-toggle="modal" data-bs-target="#signupModal">{% trans "Abrir formulario de registro" %}</a>
  </div>
</section>
{% endif %}
{% endblock %}
