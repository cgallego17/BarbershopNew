{% extends 'base.html' %}
{% load static humanize %}

{% block title %}Panel Mayoristas{% endblock %}

{% block content %}
<section class="page-header">
    <div class="page-header__bg" style="background-image: url({% static 'assets/images/backgrounds/page-header-bg.jpg' %});"></div>
    <div class="container">
        <h2 class="page-header__title">Panel Mayoristas</h2>
        <ul class="boskery-breadcrumb list-unstyled">
            <li><a href="{% url 'core:home' %}">Inicio</a></li>
            <li><span>Mayoristas</span></li>
        </ul>
    </div>
</section>

<section class="section-space">
    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <p class="text-muted">Catálogo con precios mayoristas. Añade productos al carrito y realiza tu pedido desde checkout.</p>
                <a href="{% url 'cart:detail' %}" class="boskery-btn boskery-btn--sm me-2"><i class="icon-cart"></i> Ver carrito</a>
                <a href="{% url 'orders:checkout' %}" class="boskery-btn boskery-btn--sm"><i class="icon-paper-plane"></i> Finalizar pedido</a>
            </div>
        </div>
        <div class="row gutter-y-30">
            {% for product, price in products_with_price %}
            <div class="col-xl-3 col-lg-4 col-sm-6">
                <div class="product__item">
                    <div class="product__item__image">
                        {% if product.is_featured %}<span class="product__item__badge product__item__badge--featured" title="Destacado"><i class="fas fa-star"></i></span>{% endif %}
                        {% if product.images.first %}
                        <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
                        {% else %}
                        <img src="{% static 'assets/images/products/product-1-1.png' %}" alt="{{ product.name }}">
                        {% endif %}
                    </div>
                    <div class="product__item__content">
                        <h4 class="product__item__title"><a href="{{ product.get_absolute_url }}">{{ product.name }}</a></h4>
                        <div class="product__item__price">
                            <span class="text-muted small">Precio mayorista:</span> ${{ price|floatformat:2|intcomma }}
                        </div>
                        {% if product.wholesale_price %}<small class="text-success d-block">Precio especial mayorista</small>{% endif %}
                        {% if product.in_stock %}
                        <form method="post" action="{% url 'cart:add' product.id %}" class="mt-2">
                            {% csrf_token %}
                            <input type="number" name="quantity" value="1" min="1" class="form-control form-control-sm d-inline-block mb-2" style="width:80px">
                            <input type="hidden" name="next" value="{{ request.get_full_path }}">
                            <button type="submit" class="boskery-btn boskery-btn--sm product__item__link d-block w-100">
                                <span class="boskery-btn__text">Añadir al carrito</span>
                                <i class="fas fa-cut" aria-hidden="true"></i>
                            </button>
                        </form>
                        {% else %}
                        <p class="text-muted small mb-0">Sin stock</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12"><p class="text-center text-muted">No hay productos disponibles.</p></div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}
