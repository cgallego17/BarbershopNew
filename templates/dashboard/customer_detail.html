{% extends 'dashboard/base.html' %}
{% load static humanize %}
{% block title %}Cliente {{ customer.get_full_name|default:customer.username }}{% endblock %}
{% block topbar_title %}Cliente{% endblock %}
{% block extra_css %}{% include 'dashboard/_admin_styles.html' %}{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-4">
        <div class="admin-card mb-4">
            <div class="admin-card__header">
                <h3 class="admin-card__title">Información</h3>
                <a href="{% url 'admin_panel:customer_edit' customer.pk %}" class="admin-card__action">Editar</a>
            </div>
            <div class="admin-card__body">
                <p class="mb-1"><strong>{{ customer.get_full_name|default:customer.email }}</strong></p>
                <p class="mb-1"><a href="mailto:{{ customer.email }}">{{ customer.email|default:"—" }}</a></p>
                <p class="mb-1">Tel: {{ customer.phone|default:"—" }}</p>
                <hr>
                <p class="mb-1 small">{{ customer.address|default:"—" }}</p>
                <p class="mb-1 small">{{ customer.city }}{% if customer.postal_code %} {{ customer.postal_code }}{% endif %}, {{ customer.country|default:"" }}</p>
                <hr>
                <p class="mb-0 small text-muted">Registrado: {{ customer.date_joined|date:"d/m/Y H:i" }}</p>
            </div>
        </div>
        <div class="admin-card">
            <div class="admin-card__body">
                <p class="mb-0"><strong>Total comprado</strong></p>
                <p class="fs-4 mb-0">${{ total_spent|floatformat:2|intcomma }}</p>
            </div>
        </div>
    </div>
    <div class="col-lg-8">
        <div class="admin-card">
            <div class="admin-card__header">
                <h3 class="admin-card__title">Pedidos ({{ customer.orders.count }})</h3>
                <a href="{% url 'admin_panel:order_list' %}?q={{ customer.email }}" class="admin-card__action">Ver todos</a>
            </div>
            <div class="admin-card__body p-0">
                <div class="admin-table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Pedido</th>
                                <th>Fecha</th>
                                <th>Total</th>
                                <th>Estado</th>
                                <th class="text-end">Acción</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr>
                                <td><strong>{{ order.order_number }}</strong></td>
                                <td>{{ order.created_at|date:"d/m/Y H:i" }}</td>
                                <td>${{ order.total|floatformat:2|intcomma }}</td>
                                <td><span class="admin-badge admin-badge--{{ order.status }}">{{ order.get_status_display }}</span></td>
                                <td class="text-end"><a href="{% url 'admin_panel:order_detail' order.pk %}" class="admin-link">Ver</a></td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="5" class="admin-table__empty">Sin pedidos</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="mt-3">
    <a href="{% url 'admin_panel:customer_list' %}" class="admin-btn admin-btn--secondary"><i class="fas fa-arrow-left"></i> Volver a clientes</a>
</div>
{% endblock %}
